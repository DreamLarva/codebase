<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>


<script>
    const root = [];
    let parent;
    function parse(str){
        const matches = str.match(/{{|{%/);
        const isBlock = matches[0] === '{%';
        const endIndex = matches.index;

        const chars = str.slice(0, matches ? endIndex : str.length);
        if(chars.length) {
        //...创建文本节点
        }

        if(!matches) return;

        str = str.slice(endIndex + 2);
        const leftStart = matches[0];
        const rightEnd = isBlock ? '%}' : '}}';
        const rightEndIndex = str.indexOf(rightEnd);
        const expression = str.slice(0, rightEndIndex);

        if(isBlock) {
            // 如果是块级节点
            if(  ) {
            // ...创建块级节点 el

                parent = el;
                // 是块级节点的闭合节点（endfor、endif ..）
            } else if(  ) {
                parent = parent.parent;
            }
        } else {
        //...创建变量节点 el
        }

        (parent ? parent.children : root).push(el);
        parse(str.slice(rightEndIndex + 2));
    }
</script>
</body>
</html>