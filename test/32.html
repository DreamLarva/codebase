<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>

</head>
<body>
<script>
    function processTreeDate(data) {
        const dataGroupByLevel = [];
        // 按照level 分组
        data.forEach(v => {
            const {level, sort_id, parent_id} = v;
            if (!Array.isArray(dataGroupByLevel[level - 1])) dataGroupByLevel[level - 1] = [];

            if (sort_id && parent_id === '0') {
                dataGroupByLevel[level - 1][sort_id - 1] = v;
            } else {
                dataGroupByLevel[level - 1].push(v);
            }
        });

        debugger
        //  循环直到 左侧的节点 都挂在到 靠右的节点上
        return dataGroupByLevel.filter(v => v).reduceRight((leaves, roots) => {
            for (let i = 0; i < leaves.length; i++) {
                const {parent_id, sort_id} = leaves[i];
                for (let j = 0; j < roots.length; j++) {
                    if (parent_id === roots[j].id) {
                        if (!Array.isArray(roots[j].children)) roots[j].children = [];
                        roots[j].children[sort_id - 1] = leaves[i]
                    }
                }
            }
            return roots;
        });
    }

    const data = [
        {
            id: "1",
            parent_id: "0",
            name: "编辑管理",
            desc: "",
            route_path: "",
            level: 1,
            sort_id: 1
        },
        {
            id: "2",
            parent_id: "0",
            name: "内容管理",
            desc: "",
            route_path: "",
            level: 1,
            sort_id: 2,
        },
        {
            id: "3",
            parent_id: "0",
            name: "账户管理",
            desc: "",
            route_path: "",
            level: 1,
            sort_id: 3,
        },
        {
            id: "4",
            parent_id: "1",
            name: "素材管理",
            desc: "",
            route_path: "",
            level: 2,
            sort_id: 1,
        },
        {
            id: "5",
            parent_id: "2",
            name: "文章管理",
            desc: "",
            route_path: "",
            level: 2,
            sort_id: 1,
        },
        {
            id: "6",
            parent_id: "2",
            name: "文章审核",
            desc: "",
            route_path: "",
            level: 2,
            sort_id: 2,
        },
        {
            id: "7",
            parent_id: "2",
            name: "回收站",
            desc: "",
            route_path: "",
            level: 2,
            sort_id: 3,
        },
        {
            id: "8",
            parent_id: "3",
            name: "用户管理",
            desc: "",
            route_path: "",
            level: 2,
            sort_id: 1,
        },
        {
            id: "9",
            parent_id: "3",
            name: "角色管理",
            desc: "",
            route_path: "",
            level: 2,
            sort_id: 2,
        },
        {
            id: "10",
            parent_id: "3",
            name: "权限管理",
            desc: "",
            route_path: "",
            level: 2,
            sort_id: 3,
        },
        {
            id: "11",
            parent_id: "4",
            name: "create素材",
            desc: "",
            route_path: "",
            level: 3,
            sort_id: 1,
        },
        {
            id: "12",
            parent_id: "4",
            name: "delete素材",
            desc: "",
            route_path: "",
            level: 3,
            sort_id: 2,
        },
        {
            id: "13",
            parent_id: "4",
            name: "search素材",
            desc: "",
            route_path: "",
            level: 3,
            sort_id: 3,
        },


    ];

    const result = processTreeDate(data);
    console.log(result)

</script>
</body>
</html>
